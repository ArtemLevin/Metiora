# AI Assistant for SMB

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –º–∞–ª–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –±–∏–∑–Ω–µ—Å–∞ (SMB), –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Ä—É—Ç–∏–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –¥–æ–≥–æ–≤–æ—Ä—ã) –ø–æ —à–∞–±–ª–æ–Ω–∞–º —Å –ø–æ–º–æ—â—å—é LLM (ChatGPT / –ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏).
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å email (Gmail/Outlook): —á—Ç–µ–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö –ø–∏—Å–µ–º –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç–æ–≤.
- –î–∞—à–±–æ—Ä–¥ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ (–ø–∏—Å—å–º–∞, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∑–∞–¥–∞—á–∏).
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ–ª–µ–π (–∞–¥–º–∏–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å).
- –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã –∏ –±–∏–ª–ª–∏–Ω–≥ —á–µ—Ä–µ–∑ Stripe.

–ü—Ä–æ–µ–∫—Ç –∑–∞–¥—É–º–∞–Ω –∫–∞–∫ **–ø–µ—Ç-–ø—Ä–æ–µ–∫—Ç —É—Ä–æ–≤–Ω—è Middle+/Senior Python dev** –∏ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫: FastAPI, PostgreSQL, Docker, CI/CD, Kubernetes, LLM-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –±–∏–ª–ª–∏–Ω–≥.

---

## üöÄ Roadmap

### –≠—Ç–∞–ø 1 ‚Äî MVP
- FastAPI + PostgreSQL + Alembic.
- JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.
- CRUD –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ LLM (OpenAI API).
- –ú–∏–Ω–∏-—Ñ—Ä–æ–Ω—Ç (Streamlit/Next.js).
- –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Docker Compose.

### –≠—Ç–∞–ø 2 ‚Äî –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- Gmail/Outlook API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è.
- –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø–∏—Å—å–º–∞ —Å –ø–æ–º–æ—â—å—é LLM.
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (Celery/APScheduler).
- Dashboard —Å –±–∞–∑–æ–≤–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π.
- RBAC (—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).

### –≠—Ç–∞–ø 3 ‚Äî –ü—Ä–æ–¥–∞–∫—à–Ω
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã: `auth`, `ai-service`, `email-service`, `dashboard`.
- Kubernetes + CI/CD.
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: Prometheus, Grafana, Sentry.
- OAuth2 —á–µ—Ä–µ–∑ Google/Microsoft.
- –ë–∏–ª–ª–∏–Ω–≥ (Stripe/PayPal).
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ (OpenTelemetry).

### –≠—Ç–∞–ø 4 ‚Äî –ö–æ–º–º–µ—Ä—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ LLM-–∑–∞–ø—Ä–æ—Å–æ–≤ (Redis + pgvector).
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ CRM (Hubspot/Pipedrive).
- –£–ª—É—á—à–µ–Ω–∏–µ UX (mobile-first).
- –ü—Ä–æ–¥—É–∫—Ç–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (PostHog/Mixpanel).
- –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥-–ª–µ–Ω–¥–∏–Ω–≥ –∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥.

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- **Backend**: Python 3.12+, FastAPI, Pydantic, SQLAlchemy 2.0
- **Database**: PostgreSQL, Alembic, Redis
- **Async & Queues**: Celery/RQ, APScheduler
- **Frontend**: Streamlit / Next.js (MVP)
- **AI**: OpenAI API, LangChain (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **DevOps**: Docker, Docker Compose, Kubernetes, Helm, GitHub Actions
- **Monitoring**: Prometheus, Grafana, Sentry, OpenTelemetry
- **Auth & Security**: JWT, OAuth2, RBAC
- **Payments**: Stripe / PayPal

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone https://github.com/your-username/ai-smb-assistant.git
cd ai-smb-assistant
```

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
–°–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
```env
DATABASE_URL=postgresql+asyncpg://user:password@db:5432/app
REDIS_URL=redis://redis:6379/0
OPENAI_API_KEY=your_openai_api_key
STRIPE_API_KEY=your_stripe_api_key
JWT_SECRET=your_jwt_secret
```

### 3. –ó–∞–ø—É—Å–∫ –≤ Docker
```bash
docker-compose up --build
```

### 4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
docker-compose run backend alembic upgrade head
```

### 5. –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å—É
- Backend API: http://localhost:8000/docs
- Frontend (–µ—Å–ª–∏ Streamlit): http://localhost:8501

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
pytest --cov=app
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- Prometheus: http://localhost:9090
- Grafana: http://localhost:3000
- Sentry: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ DSN

---

## üì¶ –î–µ–ø–ª–æ–π
- **MVP**: Docker Compose (Render/Heroku/DO)
- **–ü—Ä–æ–¥–∞–∫—à–Ω**: Kubernetes (k3s, Minikube, GKE/AKS/EKS)
- CI/CD: GitHub Actions (lint ‚Üí test ‚Üí build ‚Üí deploy)

---

## ü§ù –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ç–∏–Ω–≥
PR –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è. –û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: feature-branch ‚Üí pull request ‚Üí code review ‚Üí merge.

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è
MIT License. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ, —Å—Å—ã–ª–∞—è—Å—å –Ω–∞ –∞–≤—Ç–æ—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞.


---

## üß© –î–∏–∞–≥—Ä–∞–º–º—ã (UML & –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

> –í—Å–µ –¥–∏–∞–≥—Ä–∞–º–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω—ã –≤ **Mermaid** ‚Äî GitHub –∏—Ö —Ä–µ–Ω–¥–µ—Ä–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.  
> –ï—Å–ª–∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–ª–∞–≥–∏–Ω—ã –¥–ª—è VSCode/JetBrains –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ GitHub.

### 1) –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (System Context / C4-—É—Ä–æ–≤–µ–Ω—å 1)

```mermaid
graph TD
    subgraph "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
      U[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å SMB]
    end

    subgraph "–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã"
      G[Google OAuth]
      M[Microsoft OAuth]
      S[Stripe Billing]
      Gmail[Gmail API]
      Outlook[Outlook API]
      OAI[LLM Provider (OpenAI/Local)]
    end

    subgraph "AI Assistant for SMB (SaaS)"
      A[API Gateway / FastAPI]
      AU[Auth Service]
      AIS[AI Service]
      ES[Email Service]
      W[Worker / Celery]
      FE[Frontend (Streamlit/Next.js)]
      DB[(PostgreSQL)]
      R[(Redis)]
      OBJ[(Object Storage S3/MinIO)]
      MON[Monitoring: Prometheus/Grafana/Sentry]
    end

    U -->|JWT/OAuth| A
    A --> AU
    A --> FE
    A --> AIS
    A --> ES
    A --> DB
    A --> R
    W --> DB
    W --> R
    FE --> A

    AU --> G
    AU --> M
    AIS --> OAI
    ES --> Gmail
    ES --> Outlook
    A --> S
    MON -. scrape/export .- A
    MON -. scrape/export .- W
    MON -. scrape/export .- ES
    A --> OBJ
    W --> OBJ
```

### 2) –°–µ—Ä–≤–∏—Å—ã –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (Container diagram / C4-—É—Ä–æ–≤–µ–Ω—å 2)

```mermaid
graph LR
  UI[Frontend (Next.js/Streamlit)] -->|REST/GraphQL| API[FastAPI Gateway]
  API --> AUTH[Auth Service]
  API --> AI[AI Service]
  API --> EMAIL[Email Service]
  API --> BUS[Domain Layer]
  API --> CACHE[Redis]
  API --> DB[(PostgreSQL)]
  EMAIL --> QUEUE[Celery Queue]
  AI --> QUEUE
  QUEUE --> WORKER[Celery Workers]
  WORKER --> DB
  WORKER --> CACHE
  WORKER --> LLM[LLM Provider]
  EMAIL --> GMAIL[Gmail API]
  EMAIL --> OUTL[Outlook API]
  API --> BILL[Stripe]
  API --> S3[(Object Storage)]
  subgraph Observability
    PROM[Prometheus]
    GRAF[Grafana]
    SENTRY[Sentry]
  end
  API -.metrics/traces/logs.-> PROM
  WORKER -.metrics/traces/logs.-> PROM
  EMAIL -.metrics/traces/logs.-> PROM
```

### 3) –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç –Ω–∞ –≤—Ö–æ–¥—è—â–µ–µ –ø–∏—Å—å–º–æ

```mermaid
sequenceDiagram
  participant User as –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  participant Gmail as Gmail API
  participant EmailSvc as Email Service
  participant Queue as Celery Queue
  participant Worker as Worker
  participant AI as AI Service
  participant LLM as LLM Provider
  participant DB as PostgreSQL

  User->>EmailSvc: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (OAuth2)
  Gmail-->>EmailSvc: Access/Refresh —Ç–æ–∫–µ–Ω—ã
  loop –ö–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç (APScheduler)
    EmailSvc->>Gmail: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è inbox
    Gmail-->>EmailSvc: –ù–æ–≤—ã–µ –ø–∏—Å—å–º–∞
    EmailSvc->>DB: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∏—Å—å–º–æ
    EmailSvc->>Queue: –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ –∞–Ω–∞–ª–∏–∑ –ø–∏—Å—å–º–∞
  end
  Queue-->>Worker: fetch job
  Worker->>AI: –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–æ–º–ø—Ç (few-shot, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏)
  AI->>LLM: –í—ã–∑–æ–≤ LLM
  LLM-->>AI: –ß–µ—Ä–Ω–æ–≤–∏–∫ –æ—Ç–≤–µ—Ç–∞
  AI->>DB: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å draft
  Worker-->>User: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ (—á–µ—Ä–µ–∑ API/UI)
```

### 4) –ö–ª–∞—Å—Å-–¥–∏–∞–≥—Ä–∞–º–º–∞ –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ (UML)

```mermaid
classDiagram
  class User {
    +id: UUID
    +email: str
    +name: str
    +role: Role
    +created_at: datetime
  }

  class DocumentTemplate {
    +id: UUID
    +owner_id: UUID
    +name: str
    +schema: JSON
    +prompt_hint: str
    +created_at: datetime
  }

  class GeneratedDocument {
    +id: UUID
    +template_id: UUID
    +owner_id: UUID
    +payload: JSON
    +status: enum{draft,ready,failed}
    +file_url: str
    +cost_tokens: int
    +created_at: datetime
  }

  class EmailMessage {
    +id: UUID
    +external_id: str
    +owner_id: UUID
    +from: str
    +to: str
    +subject: str
    +body: text
    +received_at: datetime
  }

  class EmailReplyDraft {
    +id: UUID
    +message_id: UUID
    +owner_id: UUID
    +draft_text: text
    +quality_score: float
    +status: enum{draft,approved,sent}
    +created_at: datetime
  }

  class Plan {
    +id: UUID
    +code: str
    +name: str
    +limits: JSON
    +price_cents: int
  }

  class Subscription {
    +id: UUID
    +user_id: UUID
    +plan_id: UUID
    +status: enum{trial,active,past_due,canceled}
    +stripe_sub_id: str
    +renew_at: datetime
  }

  class AuditLog {
    +id: UUID
    +actor_id: UUID
    +action: str
    +entity: str
    +meta: JSON
    +created_at: datetime
  }

  User "1" -- "many" DocumentTemplate : owns
  DocumentTemplate "1" -- "many" GeneratedDocument : produces >
  User "1" -- "many" GeneratedDocument : owns
  User "1" -- "many" EmailMessage : owns
  EmailMessage "1" -- "1" EmailReplyDraft : has >
  User "1" -- "1" Subscription : has >
  Plan "1" -- "many" Subscription : referenced by >
  User "1" -- "many" AuditLog : acts >
```

### 5) –î–∏–∞–≥—Ä–∞–º–º–∞ –¥–µ–ø–ª–æ—è (k8s)

```mermaid
graph TD
  subgraph Cloud / K8s Cluster
    subgraph Namespace: app
      APIDeploy[Deployment: api-gateway]
      AuthD[Deployment: auth]
      AISD[Deployment: ai-service]
      ESD[Deployment: email-service]
      CeleryD[Deployment: celery-worker]
      RDS[StatefulSet: postgres]
      RedisS[StatefulSet: redis]
      MinioS[StatefulSet: minio]
      Ingress[Ingress / API LB]
    end
    subgraph Namespace: observability
      Prom[Prometheus]
      Graf[Grafana]
      SentryD[Sentry]
    end
  end

  Ingress --> APIDeploy
  APIDeploy --> AuthD
  APIDeploy --> AISD
  APIDeploy --> ESD
  APIDeploy --> RDS
  APIDeploy --> RedisS
  ESD --> CeleryD
  AISD --> CeleryD
  CeleryD --> RDS
  CeleryD --> RedisS
  APIDeploy --> MinioS
  APIDeploy -.metrics.-> Prom
  CeleryD -.metrics.-> Prom
  ESD -.metrics.-> Prom
```

---

## üîê –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–∞–≤–∞ OAuth –∏ –∫–ª—é—á–µ–π API, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ rotation –∏ —Å–µ–∫—Ä–µ—Ç-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
- –î–æ–±–∞–≤—å—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª–∏: rate limit per-user –∏ per-plan, circuit breaker –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ API.
- –õ–æ–≥–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –∏—Å–∫–ª—é—á–∞—è PII/—Å–µ–∫—Ä–µ—Ç—ã –∏–∑ –ª–æ–≥–æ–≤/—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–æ–∫.

